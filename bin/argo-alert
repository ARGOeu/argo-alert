#!/usr/bin/env python

from argparse import ArgumentParser
from ConfigParser import SafeConfigParser
import sys
import argoalert

def main(args=None):

    # Init configuration
    parser = SafeConfigParser()
    parser.read(args.config)

    kafka_endpoint = parser.get("kafka", "endpoint")
    kafka_topic = parser.get("kafka", "topic")
    alerta_endpoint = parser.get("alerta", "endpoint")
    environment = parser.get("alerta", "environment")
    alerta_token = parser.get("alerta", "token")
    log_level = parser.get("logging", "level")

    start_listening(environment, log_level, kafka_endpoint, kafka_topic,
                    alerta_endpoint, alerta_token)


if __name__ == "__main__":
    # Feed Argument parser with the description of the 3 arguments we need
    # (input_file,output_file,schema_file)
    arg_parser = ArgumentParser(
        description="ingest argo status data to alerta system")
    arg_parser.add_argument(
        "-c", "--config", help="config", dest="config", metavar="string",
        required="TRUE")

    # Parse the command line arguments accordingly and introduce them to
    # main...
    sys.exit(main(arg_parser.parse_args()))